<body>
  <h1>ARDS Learning Hub & Ventilator Simulator</h1>

  <!-- Section 1: Overview -->
  <h2>üìò ARDS Overview</h2>
  <p>
    Acute Respiratory Distress Syndrome (ARDS) is a severe form of hypoxemic respiratory failure
    caused by diffuse alveolar damage. It is characterized by bilateral opacities, reduced compliance,
    and impaired oxygenation.
  </p>

  <!-- Section 2: Research Timeline -->
  <h2>üìú Research Timeline</h2>
  <canvas id="timelineChart"></canvas>

  <!-- Section 3: Figures -->
  <h2>üìä ARDS Figures</h2>
  <div class="container">
    <div class="card">
      <h3>Pathophysiology Cascade</h3>
      <canvas id="pathoChart"></canvas>
    </div>
    <div class="card">
      <h3>Ventilator Safety</h3>
      <canvas id="safetyChart"></canvas>
    </div>
  </div>

  <!-- Section 4: Ventilator Simulation -->
  <h2>üñ•Ô∏è Ventilator Simulation</h2>
  <div class="container">
    <!-- Input Panel -->
    <div class="card">
      <h3>Set Ventilator Parameters</h3>
      <label>Tidal Volume (mL/kg PBW): <input id="tv" type="number" value="6"></label>
      <label>Rate (breaths/min): <input id="rate" type="number" value="20"></label>
      <label>PEEP (cmH‚ÇÇO): <input id="peep" type="number" value="10"></label>
      <label>FiO‚ÇÇ (%): <input id="fio2" type="number" value="60"></label>
      <label>I:E Ratio: <input id="ie" type="text" value="1:2"></label>
      <label>PBW (kg): <input id="pbw" type="number" value="70"></label>
      <label>Compliance (mL/cmH‚ÇÇO): <input id="compliance" type="number" value="30"></label>
      <button onclick="simulate()">Run Simulation</button>
    </div>

    <!-- Output Panel -->
    <div class="card">
      <h3>Simulation Output</h3>
      <div class="output" id="results"></div>
    </div>
  </div>

  <!-- Section 5: Recommendations -->
  <h2>üìä Recommendations</h2>
  <div class="card">
    <div id="recs"></div>
  </div>

  <!-- Section 6: Dynamic Blood Gas Graph -->
  <h2>ü©∏ Blood Gas Trends</h2>
  // --- Section 6: Dynamic Blood Gas Graph ---
const abgCtx = document.getElementById("abgChart").getContext("2d");
let simCount = 0;
const abgChart = new Chart(abgCtx, {
  type: "line",
  data: {
    labels: [],
    datasets: [
      {
        label: "PaO‚ÇÇ (mmHg)",
        data: [],
        borderColor: "green",
        fill: false,
        tension: 0.2
      },
      {
        label: "PaCO‚ÇÇ (mmHg)",
        data: [],
        borderColor: "orange",
        fill: false,
        tension: 0.2
      }
    ]
  },
  options: {
    responsive: true,
    plugins: { legend: { position: "top" } },
    scales: {
      x: { title: { display: true, text: "Simulation Run" } },
      y: { title: { display: true, text: "mmHg" }, min: 0, max: 200 }
    }
  }
});

// Modify simulate() to also push values into abgChart
function simulate() {
  let tv = parseFloat(document.getElementById("tv").value);
  let rate = parseFloat(document.getElementById("rate").value);
  let peep = parseFloat(document.getElementById("peep").value);
  let fio2 = parseFloat(document.getElementById("fio2").value) / 100;
  let pbw = parseFloat(document.getElementById("pbw").value);
  let compliance = parseFloat(document.getElementById("compliance").value);

  let vt_ml = tv * pbw;
  let plateau = peep + (vt_ml / compliance);
  let driving = plateau - peep;
  let mechanicalPower = 0.098 * vt_ml * rate * (plateau - (driving/2));

  let pao2 = fio2 * (500 - peep*2);
  let pf_ratio = pao2 / (fio2 * 100);
  let rox_index = (pao2 / fio2) / (rate/10);

  let paco2 = 40 * (20 / rate);
  let ph = 7.4 - (paco2 - 40) * 0.008;

  // Show text results
  let output = `
    <b>Tidal Volume:</b> ${vt_ml.toFixed(0)} mL<br>
    <b>Plateau Pressure:</b> ${plateau.toFixed(1)} cmH‚ÇÇO<br>
    <b>Driving Pressure:</b> ${driving.toFixed(1)} cmH‚ÇÇO<br>
    <b>Mechanical Power:</b> ${mechanicalPower.toFixed(1)} J/min<br>
    <b>PaO‚ÇÇ (est):</b> ${pao2.toFixed(0)} mmHg<br>
    <b>PaCO‚ÇÇ (est):</b> ${paco2.toFixed(1)} mmHg<br>
    <b>pH (est):</b> ${ph.toFixed(2)}<br>
    <b>P/F ratio:</b> ${pf_ratio.toFixed(0)}<br>
    <b>ROX index:</b> ${rox_index.toFixed(1)}
  `;
  document.getElementById("results").innerHTML = output;

  // Show recs
  let recs = "";
  if (plateau > 30) recs += "<p class='alert'>‚ö†Ô∏è Plateau >30: reduce VT or improve compliance.</p>";
  if (driving > 15) recs += "<p class='alert'>‚ö†Ô∏è Driving pressure >15: adjust settings.</p>";
  if (pf_ratio < 150) recs += "<p>üëâ Consider prone positioning.</p>";
  if (pf_ratio < 80 || rox_index < 3.85) recs += "<p>üëâ Consider ECMO referral.</p>";
  if (recs === "") recs = "<p>‚úÖ Ventilator settings are within protective range.</p>";
  document.getElementById("recs").innerHTML = recs;

  // Update blood gas chart
  simCount++;
  abgChart.data.labels.push("Run " + simCount);
  abgChart.data.datasets[0].data.push(pao2.toFixed(0));
  abgChart.data.datasets[1].data.push(paco2.toFixed(1));
  abgChart.update();
}
  <div class="card">
    <canvas id="abgChart"></canvas>
  </div>
